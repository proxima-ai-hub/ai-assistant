{"ast":null,"code":"import _asyncToGenerator from \"/Users/edubskiy/Dev/itmo/ai_assistant/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../services/user.service\";\nimport * as i2 from \"@angular/forms\";\nimport * as i3 from \"@angular/common\";\nconst _c0 = function (a0, a1) {\n  return {\n    \"chat-message-bot\": a0,\n    \"chat-message-human\": a1\n  };\n};\nfunction MainComponent_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 10)(1, \"div\", 11)(2, \"p\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const item_r4 = ctx.$implicit;\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(2, _c0, item_r4.type === \"bot\", item_r4.type === \"human\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(item_r4.text);\n  }\n}\nfunction MainComponent_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 12)(1, \"p\");\n    i0.ɵɵtext(2, \"\\u043F\\u0435\\u0447\\u0430\\u0442\\u0430\\u0435\\u0442...\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction MainComponent__svg_svg_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵnamespaceSVG();\n    i0.ɵɵelementStart(0, \"svg\", 13);\n    i0.ɵɵelement(1, \"path\", 14)(2, \"rect\", 15);\n    i0.ɵɵelementEnd();\n  }\n}\nfunction MainComponent__svg_svg_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵnamespaceSVG();\n    i0.ɵɵelementStart(0, \"svg\", 13);\n    i0.ɵɵelement(1, \"path\", 14)(2, \"path\", 16)(3, \"path\", 17)(4, \"path\", 18);\n    i0.ɵɵelementEnd();\n  }\n}\nconst _c1 = function (a0) {\n  return {\n    background: a0\n  };\n};\nexport let MainComponent = /*#__PURE__*/(() => {\n  class MainComponent {\n    constructor(service, fb) {\n      this.service = service;\n      this.fb = fb;\n      this.prompt = '';\n      this.messages = [];\n      this.istyping = false;\n      this.isPlaying = false;\n      this.sleep = ms => {\n        return new Promise(r => setTimeout(r, ms));\n      };\n    }\n    ngOnInit() {\n      this.getMessages();\n    }\n    getMessages() {\n      this.service.getMessages().subscribe(data => this.messages = data['message']);\n    }\n    sendMessage() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        if (!_this.prompt.trim() || _this.isPlaying) {\n          _this.prompt = '';\n          return;\n        }\n        _this.messages.push({\n          'text': _this.prompt,\n          'type': 'human'\n        });\n        const promptToSend = _this.prompt;\n        _this.isPlaying = true;\n        _this.prompt = '';\n        yield _this.sleep(2000);\n        _this.istyping = true;\n        if (promptToSend) {\n          const data = _this.fb.group({\n            text: promptToSend\n          });\n          const reqBody = {\n            \"history\": [{\n              \"role\": \"user\",\n              \"content\": promptToSend\n            }]\n          };\n          _this.service.handle_post_requests(reqBody, 'get_answer').subscribe(response => {\n            _this.istyping = false;\n            _this.isPlaying = false;\n            _this.messages.push({\n              'text': response['answer'],\n              'type': 'bot'\n            });\n          }, /*#__PURE__*/function () {\n            var _ref = _asyncToGenerator(function* (err) {\n              yield _this.sleep(2000);\n              _this.istyping = false;\n              _this.messages.push({\n                'text': \"Извините, мы позже вернемся к Вашему вопросу.\",\n                'type': 'bot'\n              });\n              console.error('Error sending message: ', err);\n              _this.isPlaying = false;\n            });\n            return function (_x) {\n              return _ref.apply(this, arguments);\n            };\n          }());\n        }\n      })();\n    }\n    checkTaskStatus(task_id) {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        yield _this2.sleep(5000);\n        _this2.service.handle_get_requests(task_id, 'task').subscribe(response => {\n          _this2.istyping = false;\n          _this2.messages.push({\n            'text': response['result'],\n            'type': 'bot'\n          });\n          _this2.isPlaying = false;\n        });\n      })();\n    }\n    static #_ = this.ɵfac = function MainComponent_Factory(t) {\n      return new (t || MainComponent)(i0.ɵɵdirectiveInject(i1.UserService), i0.ɵɵdirectiveInject(i2.FormBuilder));\n    };\n    static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: MainComponent,\n      selectors: [[\"app-main\"]],\n      decls: 15,\n      vars: 8,\n      consts: [[1, \"container\"], [1, \"messages\", \"mat-elevation-z5\"], [1, \"messages-header\"], [1, \"chatbox\"], [3, \"ngClass\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"chat-typing\", 4, \"ngIf\"], [1, \"wrapper\"], [\"type\", \"text\", \"placeholder\", \"\\u0412\\u0432\\u0435\\u0434\\u0438\\u0442\\u0435\", 3, \"ngModel\", \"ngModelChange\"], [3, \"ngStyle\", \"click\"], [\"xmlns\", \"http://www.w3.org/2000/svg\", \"width\", \"16\", \"height\", \"16\", \"viewBox\", \"0 0 24 24\", \"stroke-width\", \"2\", \"stroke\", \"currentColor\", \"fill\", \"none\", \"stroke-linecap\", \"round\", \"stroke-linejoin\", \"round\", 4, \"ngIf\"], [3, \"ngClass\"], [1, \"details\"], [1, \"chat-typing\"], [\"xmlns\", \"http://www.w3.org/2000/svg\", \"width\", \"16\", \"height\", \"16\", \"viewBox\", \"0 0 24 24\", \"stroke-width\", \"2\", \"stroke\", \"currentColor\", \"fill\", \"none\", \"stroke-linecap\", \"round\", \"stroke-linejoin\", \"round\"], [\"stroke\", \"none\", \"d\", \"M0 0h24v24H0z\", \"fill\", \"none\"], [\"x\", \"6\", \"y\", \"6\", \"width\", \"12\", \"height\", \"12\", \"rx\", \"2\"], [\"d\", \"M5 12l14 0\"], [\"d\", \"M13 18l6 -6\"], [\"d\", \"M13 6l6 6\"]],\n      template: function MainComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2)(3, \"h2\");\n          i0.ɵɵtext(4, \"\\u0410\\u0441\\u0441\\u0438\\u0441\\u0442\\u0435\\u043D\\u0442\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelement(5, \"hr\");\n          i0.ɵɵelementStart(6, \"div\", 3);\n          i0.ɵɵtemplate(7, MainComponent_div_7_Template, 4, 5, \"div\", 4);\n          i0.ɵɵtemplate(8, MainComponent_div_8_Template, 3, 0, \"div\", 5);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(9, \"hr\");\n          i0.ɵɵelementStart(10, \"div\", 6)(11, \"input\", 7);\n          i0.ɵɵlistener(\"ngModelChange\", function MainComponent_Template_input_ngModelChange_11_listener($event) {\n            return ctx.prompt = $event;\n          });\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(12, \"button\", 8);\n          i0.ɵɵlistener(\"click\", function MainComponent_Template_button_click_12_listener() {\n            return ctx.sendMessage();\n          });\n          i0.ɵɵtemplate(13, MainComponent__svg_svg_13_Template, 3, 0, \"svg\", 9);\n          i0.ɵɵtemplate(14, MainComponent__svg_svg_14_Template, 5, 0, \"svg\", 9);\n          i0.ɵɵelementEnd()()()();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(7);\n          i0.ɵɵproperty(\"ngForOf\", ctx.messages);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.istyping);\n          i0.ɵɵadvance(3);\n          i0.ɵɵproperty(\"ngModel\", ctx.prompt);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngStyle\", i0.ɵɵpureFunction1(6, _c1, ctx.isPlaying ? \"white\" : ctx.prompt ? \"white\" : \"#686868\"));\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.isPlaying);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", !ctx.isPlaying);\n        }\n      },\n      dependencies: [i3.NgClass, i3.NgForOf, i3.NgIf, i3.NgStyle, i2.DefaultValueAccessor, i2.NgControlStatus, i2.NgModel],\n      styles: [\"*[_ngcontent-%COMP%]{box-sizing:border-box}.container[_ngcontent-%COMP%]{display:flex;height:calc(100vh - 10px);flex-direction:column;align-items:center}.messages[_ngcontent-%COMP%]{width:40%;margin:8% 16px 16px;background:rgb(26,26,26);border-radius:16px;padding:24px}.messages-header[_ngcontent-%COMP%]{display:flex;margin-bottom:8px}.messages-header[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:50%;object-fit:cover;margin-right:16px;height:35px}.messages-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;color:#f53}.chatbox[_ngcontent-%COMP%]{padding:15px;list-style:none;overflow-y:auto;height:400px;background-color:#262a2f;border-radius:5px;scrollbar-width:none}.chatbox[_ngcontent-%COMP%]   .chat-message-bot[_ngcontent-%COMP%]{display:flex}.chatbox[_ngcontent-%COMP%]   .chat-message-bot[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{margin-right:auto;max-width:calc(100% - 130px)}.chatbox[_ngcontent-%COMP%]   .chat-message-bot[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{border-radius:18px 18px 18px 0}.chatbox[_ngcontent-%COMP%]   .chat-message-human[_ngcontent-%COMP%]{display:flex}.chatbox[_ngcontent-%COMP%]   .chat-message-human[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{margin-left:auto;max-width:calc(100% - 130px)}.chatbox[_ngcontent-%COMP%]   .chat-message-human[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{border-radius:18px 18px 0;background-color:#f53!important;color:#1a1a1a}.chatbox[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:10px 0 0;padding:8px 16px;border-radius:10px;word-wrap:break-word;background-color:#eaeaea}.chatbox[_ngcontent-%COMP%]   .chat-typing[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-style:italic;color:gray;animation:_ngcontent-%COMP%_blink 1s infinite;width:40%;border-radius:18px 18px 18px 0}@keyframes _ngcontent-%COMP%_blink{0%,to{opacity:1}50%{opacity:.5}}.chat-outgoing[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{background-color:#162887;align-self:flex-end;color:#fff}hr[_ngcontent-%COMP%]{display:block;height:1px;border:0;border-top:1px solid #ff5533}.wrapper[_ngcontent-%COMP%]{width:400px;max-width:100%;position:relative;margin-top:20px;display:flex;align-items:center}.wrapper[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{color:#e5e5e5;font-size:16px;background:#262a2f;border:1px solid #686868;border-radius:50px;padding:10px 16px;width:100%;outline:none}.wrapper[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:#686868;border-radius:50px;aspect-ratio:1;height:80%;position:absolute;top:10%;right:5px;border:none;cursor:pointer;transition:background-color .3s ease}.wrapper[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{opacity:.8}\"]\n    });\n  }\n  return MainComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}